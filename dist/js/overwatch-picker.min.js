'use strict';

angular.module('overwatch-hero-picker', []);
'use strict';

angular.module('overwatch-hero-picker').component('owHeroList', {
    bindings: {
        selectedHeroes: '='
    },
    template:'<input type=search ng-model=search ng-focus="$ctrl.focused = true" placeholder="find a hero by name, type or description"> <button ng-click="$ctrl.focused = false">X</button><ul class=list ng-show=$ctrl.focused><li ng-repeat="hero in $ctrl.heroes | filter: search | orderBy: \'type\'" ng-class="{ \'selected\': $ctrl.selectedHeroes[hero.id], \'disabled\' : !$ctrl.selectedHeroes[hero.id] && $ctrl.maxReached }"><a ng-click=$ctrl.selectHero(hero) href=javscript:void()><img ng-src={{hero.avatar}}><div class=hero-detail-wrapper><h2 class=hero-name>{{hero.name}}</h2><div class=hero-detail><p>{{hero.type}}: {{hero.description}}</p></div></div></a></li></ul>',
    controller: function controller($http, $document, $scope) {
        var _this = this;

        var checkMaxReached = function checkMaxReached() {
            _this.maxReached = Object.keys(_this.selectedHeroes).length === 6;
        };

        $http.get('data/heroes.json').then(function (response) {
            return _this.heroes = response.data;
        });

        this.focused = true;
        this.selectedHeroes = {};

        checkMaxReached();

        this.selectHero = function (hero) {

            if (angular.isDefined(_this.selectedHeroes[hero.id])) {
                delete _this.selectedHeroes[hero.id];
            } else if (!_this.maxReached) {
                _this.selectedHeroes[hero.id] = hero;
            }

            checkMaxReached();

            if (_this.maxReached) {
                _this.focused = false;
            }
        };

        $scope.$watch('$ctrl.focused', checkMaxReached);

        $document.on('keyup', function (event) {
            if (event.keyCode === 27) {
                _this.focused = false;
                $scope.$apply();
            }
        });
    }
});
'use strict';

angular.module('overwatch-hero-picker').component('owHeroPicker', {
    template:'<ow-hero-list selected-heroes=$ctrl.selectedHeroes></ow-hero-list><div class=selected-heroes><h2>You are countering:</h2><ul><li ng-repeat="hero in $ctrl.selectedHeroes"><img ng-src={{hero.avatar}}> <button ng-click=$ctrl.removeSelectedHero(hero.id)>remove</button></li></ul></div>',
    controller: function controller() {
        var _this = this;

        this.selectedHeroes = [];

        this.removeSelectedHero = function (heroId) {
            delete _this.selectedHeroes[heroId];
        };
    }
});